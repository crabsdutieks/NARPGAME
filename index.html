<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NARR DIVE</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Lilita+One&family=Baloo+2:wght@600&family=Fredoka:wght@600&display=swap" rel="stylesheet">
<style>
:root {
  --bg1:#0b1024; --bg2:#1a1f4d;
  --mint:#42ffd4; --pink:#ff82c5; --mango:#ffd166;
  --violet:#9b8cff; --danger:#ff5b6e;
}
html,body{margin:0;height:100%;overflow:hidden;
  background:linear-gradient(160deg,var(--bg1),var(--bg2));
  font-family:"Fredoka","Baloo 2","Lilita One","Bangers",sans-serif;}
#wrap{display:flex;justify-content:center;align-items:center;height:100%;}
canvas{background:transparent;display:block;border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.4);}
.hud{position:absolute;top:10px;left:0;right:0;display:flex;justify-content:space-around;
  color:white;font-size:22px;text-shadow:0 2px 4px #000;}
.overlay{position:absolute;top:0;left:0;right:0;bottom:0;display:none;justify-content:center;align-items:center;
  background:rgba(0,0,0,.6);flex-direction:column;color:white;text-align:center;}
.overlay.show{display:flex;}
.overlay h1{font-family:"Bangers","Lilita One",sans-serif;font-size:60px;
  color:var(--mango);text-shadow:0 6px 0 rgba(0,0,0,.6),0 0 20px var(--violet);}
.overlay p{font-size:20px;margin:10px 0;}
.button{margin:8px;padding:12px 24px;border:none;border-radius:12px;cursor:pointer;font-size:20px;
 background:linear-gradient(135deg,var(--pink),var(--mango));color:#0b0b0f;
 box-shadow:0 6px 0 #c34d88;transition:.15s;}
.button:active{transform:translateY(4px);box-shadow:0 2px 0 #c34d88;}
.footer{position:absolute;bottom:8px;width:100%;text-align:center;font-size:14px;color:#fff;opacity:.8;}
</style>
</head>
<body>
<div id="wrap">
<canvas id="game" width="900" height="600"></canvas>
<div class="hud"><div id="score">Score: 0</div><div id="coins">Coins: 0</div><div id="best">Best: 0</div></div>
<div id="overlay" class="overlay">
  <h1 id="title">NARR DIVE</h1>
  <p id="subtitle">Tap / click / space to dive!</p>
  <button class="button" id="btnStart">Start</button>
  <button class="button" id="btnResume" style="display:none">Resume</button>
  <button class="button" id="btnRetry" style="display:none">Retry</button>
</div>
<div class="footer">Powered by Abstract â€” $NARR</div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const overlay=document.getElementById("overlay"),title=document.getElementById("title"),subtitle=document.getElementById("subtitle");
const btnStart=document.getElementById("btnStart"),btnResume=document.getElementById("btnResume"),btnRetry=document.getElementById("btnRetry");
const HUD={score:document.getElementById("score"),coins:document.getElementById("coins"),best:document.getElementById("best")};

let best=+localStorage.getItem("narrBest")||0;HUD.best.textContent="Best: "+best;

// === Utility ===
function randRange(a,b){return Math.random()*(b-a)+a;}
function circleHit(x1,y1,r1,x2,y2,r2){let dx=x1-x2,dy=y1-y2;return dx*dx+dy*dy<=(r1+r2)**2;}

// === Classes ===
class Narwhal {
  constructor(img){
    this.x=200;this.y=300;this.v=0;this.r=28;this.tilt=0;this.img=img;
  }
  flap(){this.v=-320;}
  update(dt){
    this.v+=900*dt; if(this.v>400)this.v=400;
    this.y+=this.v*dt;
    // tilt interpolation
    const target=Math.max(-0.5,Math.min(1.2,this.v/400));
    this.tilt+= (target-this.tilt)*0.2;
  }
  draw(ctx){
    ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.tilt);
    if(this.img) ctx.drawImage(this.img,-32,-32,64,64);
    else{ctx.fillStyle="#6ef5a2";ctx.beginPath();ctx.arc(0,0,this.r,0,Math.PI*2);ctx.fill();
         ctx.fillStyle="#ffd166";ctx.fillRect(-5,-this.r-14,10,28);}
    ctx.restore();
  }
}
class ObstacleManager{
  constructor(){this.list=[];this.spawnGap=260;}
  update(dt){
    for(const o of this.list) o.x-=200*dt;
    while(this.list.length&&this.list[0].x+this.list[0].w<-100) this.list.shift();
  }
  maybeSpawn(lastX){
    if(!this.list.length||canvas.width-this.list[this.list.length-1].x>this.spawnGap){
      const gap=160;const topH=randRange(80,canvas.height-200);
      this.list.push({x:canvas.width,y:0,w:80,h:topH,passed:false,top:true});
      this.list.push({x:canvas.width,y:topH+gap,w:80,h:canvas.height-(topH+gap),passed:true,top:false});
      return {coin:{x:canvas.width+40,y:topH+gap/2,r:14,got:false}};
    }
    return null;
  }
  draw(ctx){ctx.fillStyle="#ff82c5";for(const o of this.list) ctx.fillRect(o.x,o.y,o.w,o.h);}
}
class CoinManager{
  constructor(){this.list=[];}
  update(dt){for(const c of this.list)c.x-=200*dt;while(this.list.length&&this.list[0].x<-100)this.list.shift();}
  add(c){if(c)this.list.push(c);}
  draw(ctx){ctx.fillStyle="#ffd166";for(const c of this.list) if(!c.got){ctx.beginPath();ctx.arc(c.x,c.y,c.r,0,Math.PI*2);ctx.fill();}}
}
class Game{
  constructor(){
    this.mode="start";this.narwhal=new Narwhal(null);this.obs=new ObstacleManager();this.coins=new CoinManager();
    this.score=0;this.coinCount=0;this.lastTime=0;
  }
  reset(){
    this.score=0;this.coinCount=0;this.narwhal=new Narwhal(this.narwhal.img);
    this.obs=new ObstacleManager();this.coins=new CoinManager();
    HUD.score.textContent="Score: 0";HUD.coins.textContent="Coins: 0";
  }
  update(dt){
    this.narwhal.update(dt);
    this.obs.update(dt);this.coins.update(dt);
    let c=this.obs.maybeSpawn();if(c)this.coins.add(c.coin);
    // pass score
    for(const o of this.obs.list){
      if(o.top&&!o.passed&&o.x+o.w<this.narwhal.x){o.passed=true;this.score++;HUD.score.textContent="Score: "+this.score;}
    }
    // coin pickup
    for(const c of this.coins.list){
      if(!c.got&&circleHit(this.narwhal.x,this.narwhal.y,this.narwhal.r*1.05,c.x,c.y,c.r*1.35)){
        c.got=true;this.coinCount++;this.score+=5;HUD.coins.textContent="Coins: "+this.coinCount;HUD.score.textContent="Score: "+this.score;
      }
    }
    // collisions
    for(const o of this.obs.list){
      if(this.narwhal.x+this.narwhal.r>o.x&&this.narwhal.x-this.narwhal.r<o.x+o.w&&
         this.narwhal.y+this.narwhal.r>o.y&&this.narwhal.y-this.narwhal.r<o.y+o.h){
        this.gameOver();return;
      }
    }
    if(this.narwhal.y>canvas.height||this.narwhal.y<0){this.gameOver();return;}
  }
  draw(ctx){
    // background layers
    ctx.fillStyle="#0b1024";ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#1a1f4d";ctx.fillRect(0,canvas.height-80,canvas.width,80);
    this.obs.draw(ctx);this.coins.draw(ctx);this.narwhal.draw(ctx);
  }
  loop=(t)=>{
    if(this.mode!=="play"){this.lastTime=t;requestAnimationFrame(this.loop);return;}
    const dt=Math.min(1/30,(t-this.lastTime)/1000);this.lastTime=t;
    this.update(dt);ctx.clearRect(0,0,canvas.width,canvas.height);this.draw(ctx);
    requestAnimationFrame(this.loop);
  }
  start(){this.reset();this.mode="play";hideOverlay();this.lastTime=performance.now();requestAnimationFrame(this.loop);}
  pause(){this.mode="paused";showOverlay("paused");}
  resume(){this.mode="play";hideOverlay();}
  gameOver(){this.mode="over";if(this.score>best){best=this.score;localStorage.setItem("narrBest",best);}HUD.best.textContent="Best: "+best;showOverlay("over");}
}
const game=new Game();

// === Overlay control ===
function showOverlay(m){
  overlay.classList.add("show");btnStart.style.display="none";btnResume.style.display="none";btnRetry.style.display="none";
  if(m==="start"){title.textContent="NARR DIVE";subtitle.textContent="Tap / click / space to dive!";btnStart.style.display="inline-block";}
  if(m==="paused"){title.textContent="Paused";subtitle.textContent="";btnResume.style.display="inline-block";btnRetry.style.display="inline-block";}
  if(m==="over"){title.textContent="Game Over";subtitle.textContent="Final Score: "+game.score;btnRetry.style.display="inline-block";}
}
function hideOverlay(){overlay.classList.remove("show");}

// === Inputs ===
btnStart.onclick=()=>{game.start();};
btnResume.onclick=()=>{game.resume();};
btnRetry.onclick=()=>{game.start();};
window.addEventListener("keydown",e=>{
  if(e.code==="Space"||e.code==="ArrowUp"){if(game.mode==="play")game.narwhal.flap();}
  if(e.code==="KeyP"){if(game.mode==="play")game.pause();else if(game.mode==="paused")game.resume();}
  if(e.code==="KeyR"&&game.mode==="over"){game.start();}
});
canvas.addEventListener("mousedown",()=>{if(game.mode==="play")game.narwhal.flap();});
canvas.addEventListener("touchstart",()=>{if(game.mode==="play")game.narwhal.flap();});

showOverlay("start");
</script>
</body>
</html>
