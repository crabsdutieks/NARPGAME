<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Cherry vs Monsters ‚Äî Cute Arena</title>
<style>
  :root{
    --bg1:#ffe7f4; /* cotton candy */
    --bg2:#ffeef9; /* softer wash */
    --ink:#2a2a2a;
    --ui:#ff66a1; /* cherry pink */
    --ui2:#ffc6da; /* blush */
    --good:#49d17a; /* mint */
    --bad:#ff4d6d;  /* strawberry */
    --gold:#ffcc4d;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;background:radial-gradient(circle at 50% 10%, var(--bg1), var(--bg2));font-family:system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";color:var(--ink);}
  canvas{display:block;width:100vw;height:100vh;touch-action:none}

  /* UI overlay */
  #ui{position:fixed;inset:0;pointer-events:none}
  .topbar{position:absolute;left:12px;top:12px;background:rgba(255,255,255,.8);border:2px solid var(--ui);border-radius:16px;padding:8px 12px;display:flex;gap:14px;align-items:center;pointer-events:auto;backdrop-filter: blur(4px)}
  .pill{border:2px solid var(--ink);border-radius:999px;padding:4px 10px;background:white}
  .btn{background:var(--ui);color:white;border:none;border-bottom:3px solid #d85189;box-shadow:0 2px 0 rgba(0,0,0,.08);border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;pointer-events:auto}
  .btn:active{transform:translateY(1px)}
  .round{width:44px;height:44px;border-radius:50%;display:grid;place-items:center}

  .corner{position:absolute;right:12px;top:12px;display:flex;gap:8px}
  .corner .btn{background:white;color:var(--ink);border:2px solid var(--ui);border-bottom-width:4px}

  /* Screens */
  .screen{position:absolute;inset:0;display:none;align-items:center;justify-content:center}
  .card{pointer-events:auto;background:white;border:3px solid var(--ui);border-radius:24px;padding:28px;max-width:520px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
  .title{font-size:28px;font-weight:900;margin:0 0 4px}
  .subtitle{margin:0 0 16px;color:#555}
  .row{display:flex;gap:10px;flex-wrap:wrap}

  #titleScreen .title{font-size:34px}
  #titleScreen .mascot{width:96px;height:96px;display:inline-block;vertical-align:middle;margin-right:8px}

  #gameOver h2{margin:0 0 12px}

  /* Options modal */
  #optionsModal{position:absolute;right:12px;top:68px;display:none;pointer-events:auto}
  #optionsModal .card{padding:16px;min-width:240px}
  label{display:flex;align-items:center;gap:8px;margin:8px 0}
  select, input[type="checkbox"]{accent-color:var(--ui)}

  /* Joystick */
  #joystick{position:absolute;left:16px;bottom:18px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.7);border:2px solid var(--ui2);pointer-events:auto;touch-action:none}
  #stick{position:absolute;left:50%;top:50%;width:58px;height:58px;border-radius:50%;background:var(--ui);transform:translate(-50%,-50%);box-shadow:0 4px 0 #d85189}

  /* Helpers */
  .hide{display:none!important}
  a.btn{display:inline-grid;place-items:center;text-decoration:none}
</style>
</head>
<body>
<canvas id="game" width="960" height="540" aria-label="Cherry vs Monsters game canvas"></canvas>

<div id="ui" aria-hidden="false">
  <div class="topbar" id="hud">
    <div class="pill" id="scorePill">Score: <b id="score">0</b></div>
    <div class="pill">HP: <b id="hp">100</b></div>
    <div class="pill">Wave: <b id="wave">1</b></div>
  </div>
  <div class="corner">
    <button class="btn round" id="pauseBtn" title="Pause">‚è∏Ô∏è</button>
    <button class="btn round" id="soundBtn" title="Sound on/off">üîä</button>
    <button class="btn round" id="optsBtn" title="Options">‚öôÔ∏è</button>
  </div>

  <div class="screen" id="titleScreen" style="display:flex">
    <div class="card">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <svg class="mascot" viewBox="0 0 100 100" aria-hidden="true">
          <!-- Kawaii cat-bunny hybrid, simple SVG so no assets needed -->
          <defs>
            <radialGradient id="fur" cx="50%" cy="40%" r="60%">
              <stop offset="0%" stop-color="#fff"/>
              <stop offset="100%" stop-color="#ffe6f0"/>
            </radialGradient>
          </defs>
          <circle cx="50" cy="50" r="34" fill="url(#fur)" stroke="#ff66a1" stroke-width="3"/>
          <ellipse cx="32" cy="40" rx="6" ry="8" fill="#333"/>
          <ellipse cx="68" cy="40" rx="6" ry="8" fill="#333"/>
          <circle cx="50" cy="52" r="3" fill="#333"/>
          <path d="M38 62 Q50 70 62 62" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
          <path d="M28 15 Q34 5 42 16" stroke="#ff66a1" stroke-width="3" fill="none"/>
          <path d="M58 16 Q66 5 72 15" stroke="#ff66a1" stroke-width="3" fill="none"/>
          <circle cx="50" cy="18" r="6" fill="#ff66a1"/>
        </svg>
        <div>
          <h1 class="title">Cherry vs Monsters</h1>
          <p class="subtitle">A cute arena where Cherry pops baddies with sparkle shots ‚ú®</p>
        </div>
      </div>
      <div class="row" style="margin-bottom:12px">
        <button class="btn" id="startBtn">‚ñ∂ Start</button>
        <button class="btn" id="howBtn">‚ùì How to play</button>
      </div>
      <div id="howText" class="hide">
        <ul style="margin:0 0 8px 18px;padding:0">
          <li><b>Move:</b> WASD / Arrow keys ‚Ä¢ or the pink joystick (mobile).</li>
          <li><b>Auto-fire:</b> Cherry shoots the nearest monster. Toggle in ‚öôÔ∏è Options.</li>
          <li><b>Goal:</b> Survive waves, score big. Hearts and stars are good!</li>
        </ul>
      </div>
      <small>Zero assets, single-file. Perfect for GitHub + Vercel.</small>
    </div>
  </div>

  <div class="screen" id="gameOver">
    <div class="card">
      <h2>Game Over üíî</h2>
      <p style="margin:6px 0">Score: <b id="finalScore">0</b> ‚Ä¢ Wave <b id="finalWave">1</b></p>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="retryBtn">‚Üª Play again</button>
        <a class="btn" id="shareBtn" href="#" target="_blank" rel="noopener">Share on X</a>
      </div>
    </div>
  </div>

  <div id="optionsModal">
    <div class="card">
      <label><input type="checkbox" id="autoFire" checked /> Auto-fire</label>
      <label><input type="checkbox" id="gore" checked /> Sparkle particles</label>
      <label>Difficulty
        <select id="difficulty">
          <option value="easy">Easy</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
        </select>
      </label>
    </div>
  </div>

  <div id="joystick" aria-label="Move joystick"><div id="stick"></div></div>
</div>

<script>
(function(){
  // ======== Core setup ========
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const UI = {
    title: document.getElementById('titleScreen'),
    gameOver: document.getElementById('gameOver'),
    score: document.getElementById('score'),
    hp: document.getElementById('hp'),
    wave: document.getElementById('wave'),
    finalScore: document.getElementById('finalScore'),
    finalWave: document.getElementById('finalWave'),
    shareBtn: document.getElementById('shareBtn'),
    optsModal: document.getElementById('optionsModal'),
    autoFire: document.getElementById('autoFire'),
    gore: document.getElementById('gore'),
    difficulty: document.getElementById('difficulty'),
    joystick: document.getElementById('joystick'),
    stick: document.getElementById('stick'),
  };
  const startBtn = document.getElementById('startBtn');
  const howBtn = document.getElementById('howBtn');
  const howText = document.getElementById('howText');
  const retryBtn = document.getElementById('retryBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const soundBtn = document.getElementById('soundBtn');
  const optsBtn = document.getElementById('optsBtn');

  const WORLD = { w: 960, h: 540 };
  let scale = 1, offsetX = 0, offsetY = 0;
  function resize(){
    const vw = window.innerWidth, vh = window.innerHeight;
    const s = Math.min(vw / WORLD.w, vh / WORLD.h);
    scale = s; offsetX = (vw - WORLD.w * s) * 0.5; offsetY = (vh - WORLD.h * s) * 0.5;
    canvas.width = vw; canvas.height = vh;
  }
  window.addEventListener('resize', resize);
  resize();

  // Prevent scroll on mobile when using joystick
  document.body.addEventListener('touchmove', (e)=>{ if (e.target.closest('#joystick')) e.preventDefault(); }, {passive:false});

  // ======== Tiny sound (no assets) ========
  let audioOn = true;
  let AC; // AudioContext lazy
  function beep(type=0, freq=420, dur=0.08, vol=0.03){
    if(!audioOn) return; if(!AC) { AC = new (window.AudioContext||window.webkitAudioContext)(); }
    const now = AC.currentTime; const o = AC.createOscillator(); const g = AC.createGain();
    o.type = ['triangle','square','sine','sawtooth'][type%4]; o.frequency.value = freq;
    g.gain.value = vol; o.connect(g).connect(AC.destination);
    o.start(now); o.stop(now + dur);
  }

  // ======== Input ========
  const keys = new Set();
  window.addEventListener('keydown', e=>{ keys.add(e.key.toLowerCase()); if(e.key===' ') e.preventDefault(); });
  window.addEventListener('keyup', e=> keys.delete(e.key.toLowerCase()));

  // Virtual joystick
  let joyActive = false, joyBase = {x:0,y:0}, joyVec = {x:0,y:0};
  function joyPos(e){
    const rect = UI.joystick.getBoundingClientRect();
    const x = (e.touches? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches? e.touches[0].clientY : e.clientY) - rect.top;
    return {x,y, rect};
  }
  function setStick(x,y){ UI.stick.style.transform = `translate(${x}px, ${y}px)`; }

  UI.joystick.addEventListener('pointerdown', e=>{
    joyActive = true; UI.joystick.setPointerCapture(e.pointerId);
    const p = joyPos(e); joyBase = {x:p.x, y:p.y};
  });
  UI.joystick.addEventListener('pointermove', e=>{
    if(!joyActive) return; const p = joyPos(e);
    const dx = p.x - joyBase.x, dy = p.y - joyBase.y; const maxR = 46;
    const len = Math.hypot(dx,dy) || 1; const cl = Math.min(len, maxR);
    const nx = dx / len * cl, ny = dy / len * cl;
    setStick(nx + 60 - 29, ny + 60 - 29);
    joyVec.x = (dx / maxR); joyVec.y = (dy / maxR);
  });
  ['pointerup','pointercancel','pointerleave'].forEach(ev=> UI.joystick.addEventListener(ev, e=>{
    joyActive = false; joyVec.x = joyVec.y = 0; setStick(-29 + 60, -29 + 60);
  }));

  // ======== Game state ========
  let state = 'title'; // 'play' | 'paused' | 'gameover'
  let time = 0; let last = performance.now();
  let prevEnemyCount = 0;

  const rng = { seed: 1234567, next(){ this.seed = (this.seed * 1664525 + 1013904223) >>> 0; return this.seed / 4294967296; } };
  function rand(min, max){ return min + (max-min) * rng.next(); }

  // Entities
  const player = { x: WORLD.w/2, y: WORLD.h/2, r: 18, hp: 100, speed: 220, ifr: 0 };
  const bullets = []; // {x,y,vx,vy,r,life}
  const enemies = []; // {x,y,r,speed,hp}
  const particles = []; // {x,y,vx,vy,life}
  const items = []; // {x,y,type}
  let score = 0, wave = 1, spawnTimer = 0, fireTimer = 0;

  function reset(){
    player.x = WORLD.w/2; player.y = WORLD.h/2; player.hp = 100; player.ifr = 0;
    bullets.length = enemies.length = particles.length = items.length = 0;
    score = 0; wave = 1; spawnTimer = 0; fireTimer = 0; rng.seed = (Math.random()*1e9)>>>0;
    prevEnemyCount = 0;
    UI.score.textContent = '0'; UI.hp.textContent = '100'; UI.wave.textContent = '1';
    state = 'play';
  }

  // Difficulty parameters
  function diff(){
    const d = UI.difficulty.value;
    if(d==='easy') return { spawn: 1.1, enemySpeed:[55,85], damage: 14 };
    if(d==='hard') return { spawn: 0.75, enemySpeed:[90,140], damage: 20 };
    return { spawn: 0.95, enemySpeed:[70,110], damage: 16 };
  }

  function spawnEnemy(){
    const edge = Math.floor(rand(0,4));
    const margin = 30;
    let x = 0, y = 0;
    if(edge===0){ x = -margin; y = rand(0,WORLD.h); }
    else if(edge===1){ x = WORLD.w+margin; y = rand(0,WORLD.h); }
    else if(edge===2){ y = -margin; x = rand(0,WORLD.w); }
    else { y = WORLD.h+margin; x = rand(0,WORLD.w); }
    const sp = rand(...diff().enemySpeed);
    enemies.push({x,y,r:16, speed: sp, hp: 2});
  }

  function tryDrop(x,y){
    if(rand(0,1) < 0.12) items.push({x,y,type:'heart'});
    else if(rand(0,1) < 0.08) items.push({x,y,type:'star'});
  }

  function nearestEnemy(){
    let best=null,bd=1e9; for(const e of enemies){const d=(e.x-player.x)**2+(e.y-player.y)**2; if(d<bd){bd=d; best=e;}} return best;
  }

  function shoot(){
    const target = nearestEnemy();
    let dirX=1, dirY=0;
    if(target){ const dx=target.x-player.x, dy=target.y-player.y; const L=Math.hypot(dx,dy)||1; dirX=dx/L; dirY=dy/L; }
    else { // fallback to keyboard aim
      const ax = (keys.has('arrowright')||keys.has('d')) - (keys.has('arrowleft')||keys.has('a'));
      const ay = (keys.has('arrowdown')||keys.has('s')) - (keys.has('arrowup')||keys.has('w'));
      const L=Math.hypot(ax,ay)||1; dirX=ax/L; dirY=ay/L;
    }
    const speed = 420; bullets.push({x:player.x, y:player.y, vx:dirX*speed, vy:dirY*speed, r:4, life:1.2});
    beep(0, 720, .04, .04);
  }

  function addSparkles(x,y, base=10){
    if(!UI.gore.checked) return;
    for(let i=0;i<base;i++){
      const a = rand(0,Math.PI*2), v = rand(40,140);
      particles.push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,life: rand(0.3,0.9)});
    }
  }

  function circleHit(ax,ay,ar, bx,by,br){ const dx=ax-bx, dy=ay-by; const r=ar+br; return dx*dx+dy*dy <= r*r; }

  function update(dt){
    if(state!=='play') return;
    time += dt; if(player.ifr>0) player.ifr -= dt;

    // Movement
    let vx = ((keys.has('arrowright')||keys.has('d'))?1:0) - ((keys.has('arrowleft')||keys.has('a'))?1:0) + joyVec.x;
    let vy = ((keys.has('arrowdown')||keys.has('s'))?1:0) - ((keys.has('arrowup')||keys.has('w'))?1:0) + joyVec.y;
    const L = Math.hypot(vx,vy); if(L>1){ vx/=L; vy/=L; }
    player.x += vx * player.speed * dt; player.y += vy * player.speed * dt;
    player.x = Math.max(player.r, Math.min(WORLD.w-player.r, player.x));
    player.y = Math.max(player.r, Math.min(WORLD.h-player.r, player.y));

    // Firing
    fireTimer -= dt; if(UI.autoFire.checked && fireTimer<=0){ fireTimer = 0.17; shoot(); }

    // Bullets
    for(let i=bullets.length-1;i>=0;i--){ const b=bullets[i]; b.x+=b.vx*dt; b.y+=b.vy*dt; b.life-=dt; if(b.life<=0) bullets.splice(i,1); }

    // Enemies spawn cadence
    spawnTimer -= dt; if(spawnTimer<=0){
      spawnTimer = Math.max(0.3, 1.8 - wave*0.06) * diff().spawn;
      spawnEnemy(); if(Math.random()<0.08+wave*0.01) spawnEnemy();
    }

    // Enemies update + collisions
    for(let i=enemies.length-1;i>=0;i--){ const e=enemies[i];
      const dx = player.x - e.x, dy = player.y - e.y; const l = Math.hypot(dx,dy)||1; const ux=dx/l, uy=dy/l;
      e.x += ux * e.speed * dt; e.y += uy * e.speed * dt;
      // hit by bullets
      for(let j=bullets.length-1;j>=0;j--){ const b=bullets[j]; if(circleHit(e.x,e.y,e.r, b.x,b.y,b.r)){
        bullets.splice(j,1); e.hp--; addSparkles(e.x,e.y,8); beep(2, 540, .03, .03);
        if(e.hp<=0){ enemies.splice(i,1); score+=10; UI.score.textContent = score; tryDrop(e.x,e.y); break; }
      }}
      // touch player
      if(circleHit(e.x,e.y,e.r, player.x,player.y,player.r)){
        if(player.ifr<=0){ player.hp -= diff().damage; player.ifr = 0.8; addSparkles(player.x,player.y,14); beep(1, 180, .06, .05); UI.hp.textContent = Math.max(0,player.hp);
          // Knockback
          const kdx = player.x - e.x, kdy = player.y - e.y; const kl = Math.hypot(kdx,kdy)||1;
          player.x += (kdx/kl)*20; player.y += (kdy/kl)*20;
          if(player.hp<=0){ endGame(); return; }
        }
      }
    }

    // Items
    for(let i=items.length-1;i>=0;i--){ const it=items[i]; if(circleHit(it.x,it.y,10, player.x,player.y,player.r)){
      if(it.type==='heart'){ player.hp = Math.min(100, player.hp+20); UI.hp.textContent = player.hp; beep(0, 820, .08, .05); }
      else if(it.type==='star'){ score += 25; UI.score.textContent = score; beep(2, 980, .05, .04); }
      items.splice(i,1);
    }}

    // Particles
    for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.x+=p.vx*dt; p.y+=p.vy*dt; p.vx*=0.98; p.vy*=0.98; p.life-=dt; if(p.life<=0) particles.splice(i,1); }

    // End-of-wave detection (latch to avoid multi-increment)
    if(prevEnemyCount > 0 && enemies.length === 0){
      wave++; UI.wave.textContent = wave; spawnTimer = 0;
    }
    prevEnemyCount = enemies.length;
  }

  function draw(){
    // Setup transform to world coords
    ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width, canvas.height);
    ctx.setTransform(scale,0,0,scale, offsetX, offsetY);

    // Background grid of hearts/stars
    ctx.fillStyle = '#fff7fb'; ctx.fillRect(0,0,WORLD.w,WORLD.h);
    const step = 60; ctx.globalAlpha = 0.4; ctx.fillStyle = '#ffe3ef';
    for(let y=20;y<WORLD.h;y+=step){ for(let x=20;x<WORLD.w;x+=step){
      ctx.beginPath(); ctx.arc(x+Math.sin((x+y+time)*0.002)*3, y+Math.cos((x+y-time)*0.002)*3, 2.5, 0, Math.PI*2); ctx.fill();
    }} ctx.globalAlpha = 1;

    // Items
    for(const it of items){
      if(it.type==='heart'){
        drawHeart(it.x,it.y,10,'#ff6b9a');
      } else if(it.type==='star'){
        drawStar(it.x,it.y,10,10,'#ffcc4d');
      }
    }

    // Particles
    for(const p of particles){ ctx.globalAlpha = Math.max(0, p.life); ctx.fillStyle = '#ff99c9'; ctx.beginPath(); ctx.arc(p.x,p.y,2,0,Math.PI*2); ctx.fill(); }
    ctx.globalAlpha = 1;

    // Enemies (gum blobs)
    for(const e of enemies){
      ctx.fillStyle = '#8b6cff'; ctx.beginPath(); ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle = '#6045c9'; ctx.lineWidth = 3; ctx.stroke();
      // face
      ctx.fillStyle = '#222'; ctx.beginPath(); ctx.arc(e.x-5,e.y-4,2.5,0,Math.PI*2); ctx.arc(e.x+5,e.y-4,2.5,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.moveTo(e.x-6,e.y+5); ctx.quadraticCurveTo(e.x,e.y+10,e.x+6,e.y+5); ctx.strokeStyle='#222'; ctx.lineWidth=2; ctx.stroke();
    }

    // Player (Cherry)
    drawCherry(player.x, player.y, player.r, player.ifr>0? '#ffd9e8':'#ffffff');

    // Bullets
    ctx.fillStyle = '#ff6b9a'; for(const b of bullets){ ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill(); }

    // Border vignette
    ctx.strokeStyle = '#ffb3cf'; ctx.lineWidth = 8; ctx.strokeRect(4,4,WORLD.w-8,WORLD.h-8);
  }

  function drawCherry(x,y,r,face='#fff'){
    // head
    ctx.save();
    ctx.translate(x,y);
    ctx.fillStyle = face; ctx.strokeStyle = '#ff66a1'; ctx.lineWidth = 4;
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill(); ctx.stroke();
    // eyes + mouth
    ctx.fillStyle = '#2a2a2a'; ctx.beginPath(); ctx.arc(-6,-4,3,0,Math.PI*2); ctx.arc(6,-4,3,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.moveTo(-6,6); ctx.quadraticCurveTo(0,10,6,6); ctx.strokeStyle='#2a2a2a'; ctx.lineWidth=2; ctx.stroke();
    // bow
    ctx.fillStyle = '#ff66a1'; ctx.beginPath(); ctx.arc(0, -r+6, 6, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(-10,-r+8,7,5,0,0,Math.PI*2); ctx.ellipse(10,-r+8,7,5,0,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }
  function drawHeart(x,y,r,c){ ctx.save(); ctx.translate(x,y); ctx.fillStyle=c; ctx.beginPath(); ctx.moveTo(0,r/2); ctx.bezierCurveTo(r, -r/2, r*1.2, r/2, 0, r); ctx.bezierCurveTo(-r*1.2, r/2, -r, -r/2, 0, r/2); ctx.fill(); ctx.restore(); }
  function drawStar(cx,cy,spikes,outer, color){ const rot=Math.PI/2*3; let x=cx,y=cy,step=Math.PI/spikes; ctx.save(); ctx.beginPath(); ctx.moveTo(cx, cy-outer); for(let i=0;i<spikes;i++){ x=cx+Math.cos(rot+i*step*2)*outer; y=cy+Math.sin(rot+i*step*2)*outer; ctx.lineTo(x,y); x=cx+Math.cos(rot+(i*2+1)*step)*(outer*0.5); y=cy+Math.sin(rot+(i*2+1)*step)*(outer*0.5); ctx.lineTo(x,y);} ctx.closePath(); ctx.fillStyle=color; ctx.fill(); ctx.restore(); }

  function end
